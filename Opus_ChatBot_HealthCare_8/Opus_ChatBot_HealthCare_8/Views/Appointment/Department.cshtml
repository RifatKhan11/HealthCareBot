@model DepartmentVM
@{
    ViewData["Title"] = "Department List";
}

@section Style{
    <link href="https://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" rel="Stylesheet">
    <link href="https://www.jqueryscript.net/demo/Material-Time-Picker-Plugin-jQuery-MDTimePicker/mdtimepicker.css" rel="Stylesheet">
    <link href="~/SweetAlert/sweetalert2.css" rel="stylesheet" />
}
<style>
    .swal2-icon {
        width: 2em !important;
        height: 2em !important;
        margin: 0.25em auto 0.5em !important;
        border: 0.25em solid transparent;
    }
</style>

<div class="row"  id="create" >
    <div class="col-md-12">
        <a onclick="Add()" class="btn btn-primary" style="float: right; margin: 20px;">Create Department</a>
    </div>
</div>
<div class="card mb-3" id="createDepartment" style="display:none;">
  <div class="card-header">
      <h5 class="card-title">Create new Department</h5> 
  </div>
  <div class="card-body"> 
     

    <form id="departmentForm" asp-action="UpdateDepartment" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group row">
                                <label class="col-md-12">Department Name</label>
                                <div class="col-md-12"> 
                                     <input type="hidden" id="Depid" name="id" class="form-control" />
                                    <input type="hidden" value="@ViewBag.botkey" id="botkey" name="botkey" class="form-control" />
                                <input type="hidden" value="@ViewBag.branchInfoId" id="branchId" name="branchId" class="form-control" />
                                    <input type="text" id="departmentName"  name="departmentName" class="form-control" />
                                </div>
                            </div>
                              
                        </div>
                         <div class="col-md-6"> 
                             <div class="form-group row">
                                <label class="col-md-12">Short Name</label>
                                <div class="col-md-12"> 
                                    <input type="text" id="shortName"  name="shortName" class="form-control" />
                                </div>
                            </div>
                             
                        </div>
                         <div class="col-md-6"> 
                             <div class="form-group row">
                                <label class="col-md-12">Department Code</label>
                                <div class="col-md-12"> 
                                    <input type="text" id="departmentCode"  name="departmentCode" class="form-control" />
                                </div>
                            </div>
                             
                        </div>
                         
                     <div class="col-md-6">
                         
                    <div class="form-group row">
                        <label class="col-md-12">Status</label>
                        <div class="col-md-12">
                           <select class="form-control" name="status" id="status">
                                    @if (Model.status == 1)
                                    {   
                                        <option value="1" selected>Active</option>
                                        <option value="0">InActive</option>
                                    }
                                    else if (Model.status == 0)
                                    {
                                        <option value="1">Active</option>
                                        <option value="0" selected>InActive</option>
                                    }
                                    else  
                                    {
                                        <option value="1" selected>Active</option>
                                        <option value="0">InActive</option>
                                    }
                                     

                                </select>
                        </div>
                    </div>
                     <div class="form-group row">

                                        <div class="col-md-8" style="padding-left: 60px;">
                                           @if (Model.thumbUrl == null || Model.thumbUrl == "")
                                {
                                     <img id="docFile" src="~/chatbox/other.png" style="height:100px;width:100px;cursor:pointer!important;"  />
                                      
                                }
                                else
                            {
                                <img src="~/@Model.thumbUrl" style="height:200px;width:200px;border:1px solid #ddd;background-color:#eee;cursor:pointer!important" id="docFile" />
                            }
                                            @*<img id="docFile" src="~/chatbox/other.png" style="height:100px;width:100px;cursor:pointer!important;"  />*@
                                        </div> 
                                        
                                        <input type="hidden" id="userDocFile" />
                                        <input type="hidden" name="thumbUrl" value="@Model.thumbUrl" /> 
                                        <input type="file" style="display:none;" title="Photo Upload" id="userProfile" name="fileUrl" class="img-thumbnail float-left" />
                                        <label class="col-md-8" style="margin-left: 35px; margin-top: 7px;">
                                            <input type="button" class="btn btn-info btn-sm" onclick="fnFileUpload()" value="Upload Image" style="font-size: 13px !important; width: 120px; height: 30px;" />
                                             
                                        </label>

                                    </div>
                                    
                        
                
                        </div>
                    </div>
                     
                    </div>  
                <div class="modal-footer">  
                    <a class="btn btn-small btn-danger" onclick="Dismis()">Close</a>
                    <a class="btn btn-small btn-success" onclick="Save()" id="Save">Save</a>
                    <button class="btn btn-small btn-success d-none" id="submit" type="submit">Save</button>
                    <a class="btn btn-small btn-warning" onclick="Update()" id="Update" style="display:none;">Update</a>

                </div>
            </form>

  </div>
</div>




<div class="card mb-3">
    <div class="card-header">
        <i class="fas fa-table"></i>
        Appointment List
    </div>
    <div class="card-body">

        <div class="table-responsive">
            <table class="table table-bordered" width="100%" cellspacing="0" id="tblVisitorInfo">
                <thead>
                    <tr>
                        <th>#SL</th>
                        <th>Department Name</th>
                        <th>Short Name</th>
                        <th>Department Code</th> 
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="dtVisitorInfo">
                </tbody>
            </table>
        </div>
    </div>
    <div class="card-footer small text-muted"></div>
</div>



<!-- The Modal -->
<div class="modal" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Update Appointment</h4>
                <button type="button" class="close" onclick="Dismis()">&times;</button>
            </div>

            <!-- Modal body -->
            <form id="EditAppointmentForm">
                <div class="modal-body">
                    <div class="form-group row">
                        <label class="col-md-12">Department Name</label>
                        <div class="col-md-12">
                            <input type="hidden" id="Depid" name="id" class="form-control" />
                            <input type="text" id="departmentname"  name="departmentName" class="form-control" />
                        </div>
                    </div>
                   <div class="form-group row">
                        <label class="col-md-12">Short Name</label>
                        <div class="col-md-12">
                            
                            <input type="text" id="shortname"  name="shortName" class="form-control" />
                        </div>
                    </div> 
                      <div class="form-group row">
                                <label class="col-md-12">Department Code</label>
                                <div class="col-md-12"> 
                                    <input type="text" id="departmentcode"  name="departmentCode" class="form-control" />
                                </div>
                            </div> 
                             
                         
                    <div class="form-group row">
                        <label class="col-md-12">Status</label>
                        <div class="col-md-12">
                           <select class="form-control" name="Departmentstatus" id="status">
                                    @if (Model.status == 1)
                                    {   
                                        <option value="1" selected>Active</option>
                                        <option value="0">InActive</option>
                                    }
                                    else if (Model.status == 0)
                                    {
                                        <option value="1">Active</option>
                                        <option value="0" selected>InActive</option>
                                    }
                                    else  
                                    {
                                        <option value="1" selected>Active</option>
                                        <option value="0">InActive</option>
                                    }
                                     

                                </select>
                        </div>
                    </div>
                     
        </div>
                
                <!-- Modal footer -->
                <div class="modal-footer">
                    @*<button type="button" onclick="close()" class="btn btn-danger btn-small" data-dismiss="modal">Close</button>*@

                    <a class="btn btn-small btn-danger" onclick="Dismis()">Close</a>
                    <a class="btn btn-small btn-warning" onclick="Update()">Update</a>
                </div>
            </form>

        </div>
    </div>
</div>



@section Scripts{
    <script src="https://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
    <script src="https://www.jqueryscript.net/demo/Material-Time-Picker-Plugin-jQuery-MDTimePicker/mdtimepicker.js"></script>
    <script src="~/SweetAlert/sweetalert2.common.js"></script>
    <script src="~/SweetAlert/sweetalert2.js"></script>
    <script>
        $(document).ready(function () {
            var date = '@DateTime.Now.ToString("MM-dd-yyyy")';


            $('#frmDate').datepicker({ dateFormat: "dd-M-yy", showAnim: "scale", changeMonth: true, changeYear: true, yearRange: "1900:2100" });
            $('#frmTime').mdtimepicker({
                timeFormat: 'hh:mm:ss.000',
                format: 'hh:mm',
                pick12HourFormat: false,
                theme: 'dark',
                readOnly: true,
                hourPadding: true,
                clearBtn: false
            });



            $('#dataTable').DataTable({

                "pageLength": 100
            });

            $(function () {
                $('[data-toggle="tooltip"]').tooltip()
            });

            var botKey = '20dddd7c-734e-4c80-bbed-fae386e0291e';
            var branchId = $('#branchId').val();
            Common.Ajax('GET', '/Appointment/GetAllDepartmentData?branchId=' + branchId, [], 'json', ajaxDepartmentData, false);

            //var interval = setInterval(function () {
            //    Common.Ajax('GET', '/Appointment/GetTodayAppointmentData?date=' + date, [], 'json', ajaxTodayAppointmentData, false);
            //}, 60000);
        });


        function ajaxDepartmentData(res) {
            console.log(res);
            var option = '';
             $('#tblVisitorInfo').dataTable().fnClearTable();
            $('#tblVisitorInfo').dataTable().fnDestroy();
            $.each(res, function (i, item) {
                var status = 'light';
                if (item.departmentstatus == "Active") {
                    status = 'success';
                }
                else if (item.departmentstatus == "InActive") {
                    status = 'warning';
                }
                
                else {

                }
                option += `<tr>
                                   <td>${i + 1}</td>
                                   <td>${item.departmentName}</td>
                                   <td>${item.shortName}</td>
                                   <td> ${item.departmentCode} </td> 
                                    <td><span class="badge badge-${status}">${item.departmentstatus}</span></td>
                                    <td>
                                          <a class="btn btn-sm btn-success" href="#" onclick="Edit(${item.id},'${item.departmentName}','${item.shortName}','${item.departmentCode}','${item.status}','${item.thumbUrl}')">Edit</a>
                                         <a class="btn btn-sm btn-danger" onclick="Delete(${item.id})">Delete</a>
                                    </td>
                                </tr>`
            })

            $('#dtVisitorInfo').empty();
            $('#dtVisitorInfo').append(option);
             $('#tblVisitorInfo').DataTable({
                "ordering": false,
                scrollX: true,
                scrollY: "490px",
                "scrollCollapse": true
            });
        }



        function Delete(id) {
            swal({
                title: 'Are you sure?', text: 'Do you want to delete this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, delete it!'
            }).then(function () {
                $.ajax({
                    url: '/Appointment/DeleteDepartment?id=' + id,
                    method: 'GET',
                    success: function (data) {
                        location.reload();
                    },
                    error: function (error) {
                        console.error('Error:', error);
                    }
                });
            });
        }
        function Dismis() {
            $('#createDepartment').hide();
            $('#create').show();
           location.reload();
        }

        function Add() {
            $('#createDepartment').show();
            $('#create').hide();
        }
         
        function Edit(id, departmentName, shortName, departmentCode, status,thumbUrl) {
            $('#Depid').val(id); 
            $('#departmentName').val(departmentName);
            $('#shortName').val(shortName);
            $('#departmentCode').val(departmentCode);
            $('#status').val(status);
            $('#docFile').attr('src', '/'+thumbUrl);
            $('#createDepartment').show();
            $('#Update').show();
             $('#Save').hide();
        }


        function Save() {
            var data = $('#departmentForm').serialize();

            swal({
                title: 'Are you sure?', text: 'Do you want to update this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, update it!'
            }).then(function () {
                $('#submit').click();
                 
            });
        }

         function Update() {
            var data = $('#departmentForm').serialize();

            swal({
                title: 'Are you sure?', text: 'Do you want to update this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, update it!'
            }).then(function () {
                $('#submit').click();
                 
            });
        }

        // function Update() {
        //    var data = $('#EditAppointmentForm').serialize();
        //    alert(data);

        //    swal({
        //        title: 'Are you sure?', text: 'Do you want to update this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, update it!'
        //    }).then(function () {
        //        $.ajax({
        //            url: '/Appointment/UpdateDepartment',
        //            method: 'POST',
        //            data: data,
        //            success: function (data) {
        //                location.reload();
        //            },
        //            error: function (error) {
        //                console.error('Error:', error);
        //            }
        //        });
        //    });
        //}

         function fnFileUpload() {
            $('#userProfile').click();

        }

         $("#userProfile").change(function () {
            readURLuserProfile(this);
        });


        function readURLuserProfile(input) {
            if (input.files && input.files[0]) {
                var filerdr = new FileReader();
                filerdr.onload = function (e) {
                    var srcUrl = e.target.result;

                    var fileExtension = (input.files[0].name || '').split('.').pop().toLowerCase();

                    switch (fileExtension) {
                        case 'pdf':

                            $('#docFile').attr("src", "/images/PDF_file_icon.webp");
                            $('#userDocFile').val(e.target.result);

                            console.log('PDF file selected');

                            break;
                        
                        default:
                            $('#docFile').attr('src', e.target.result);

                            console.log('Unknown file type selected');

                    }
                };
                filerdr.readAsDataURL(input.files[0]);
            }
        }

    </script>
}
