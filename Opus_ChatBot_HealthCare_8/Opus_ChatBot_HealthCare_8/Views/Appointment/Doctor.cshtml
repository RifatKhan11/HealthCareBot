@model DoctorVM
@{
    ViewData["Title"] = "Doctor List";
}

@section Style{
    <link href="https://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" rel="Stylesheet">
    <link href="https://www.jqueryscript.net/demo/Material-Time-Picker-Plugin-jQuery-MDTimePicker/mdtimepicker.css" rel="Stylesheet">
    <link href="~/SweetAlert/sweetalert2.css" rel="stylesheet" />
}
<style>
    .swal2-icon {         
        width: 2em !important;
        height: 2em !important;
        margin: 0.25em auto 0.5em !important;
        border: 0.25em solid transparent;        
    }
</style>

<div class="row"  id="create" >
    <div class="col-md-12">
        <a onclick="Add()" class="btn btn-primary" style="float: right; margin: 20px;">Create Doctor List</a>
    </div>
</div>
<div class="card mb-3" id="createDoctor" style="display:none;">
  <div class="card-header">
      <h5 class="card-title">Create new Doctor</h5> 
  </div>
  <div class="card-body"> 
     

    <form id="EditAppointmentForm">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group row">
                                <label class="col-md-12">Name</label>
                                <div class="col-md-12">
                                    <input type="hidden" id="frmid" name="id" class="form-control" />
                                    <input type="hidden" value="@ViewBag.botkey" id="botkey" name="botkey" class="form-control" />
                                <input type="hidden" value="@ViewBag.branchInfoId" id="branchId" name="branchId" class="form-control" />
                                    <input type="text" id="name"  name="name" class="form-control" />
                                </div>
                            </div>
                              
                        </div>
                         <div class="col-md-6"> 
                             <div class="form-group row">
                                <label class="col-md-12">Designation Name</label>
                                <div class="col-md-12"> 
                                    <input type="text" id="designationName"  name="designationName" class="form-control" />
                                </div>
                            </div>
                             
                        </div>
                         <div class="col-md-6"> 
                              
                              <div class="form-group row">
                                <label class="col-md-12">Department Name</label>
                                <div class="col-md-12"> 
                                    <input  type="hidden" id="departmentName"  name="departmentName" class="form-control" />
                                   <select class="form-control" name="departmentId" id="departmentId">
                                    <option value="" >Select Deparment</option> 
                                     @foreach (var item in Model.DepartmentList)
                                    { 
                                        @if(Model.DepartmentList?.FirstOrDefault().Id == item.Id){
                                            <option value="@item.Id" selected>@item.departmentName</option>
                                        }
                                        else
                                        {
                                         <option value="@item.Id">@item.departmentName</option>

                                        }     
                                     }

                                    
                                </select> 
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-md-12">Doctor Specialization</label>
                                <div class="col-md-12"> 
                                     <select class="form-control" name="doctorSpecializationId" id="doctorSpecializationId">
                                    <option value="" >Select Doctor Specialization</option> 
                                     @foreach (var item in Model.doctorSpecializationList)
                                    { 
                                        @if(Model.doctorSpecializationList?.FirstOrDefault().Id == item.Id){
                                            <option value="@item.Id" selected>@item.name</option>
                                        }
                                        else
                                        {
                                         <option value="@item.Id">@item.name</option>

                                        }     
                                     }

                                    
                                </select>  
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                         <div class="form-group row">
                        <label class="col-md-12">Gender</label>
                        <div class="col-md-12"> 
                            <select class="form-control" name="gender" id="gender"> 
                                  
                                    @if (Model.gender == "Male")
                                    {
                                        <option value="Male" selected>Male</option>
                                        <option value="Female">Female</option>
                                    }
                                    else if (Model.gender == "Female")
                                    {
                                          <option value="Male">Male</option>
                                        <option value="Female" selected>Female</option>
                                    }
                                    else  
                                    {
                                         <option value="Male" selected>Male</option>
                                        <option value="Female">Female</option>
                                    } 

                                </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-md-12">Status</label>
                        <div class="col-md-12">
                           <select class="form-control" name="status" id="status">
                                    @if (Model.status == 1)
                                    {   
                                        <option value="1" selected>Active</option>
                                        <option value="0">InActive</option>
                                    }
                                    else if (Model.status == 0)
                                    {
                                        <option value="1">Active</option>
                                        <option value="0" selected>InActive</option>
                                    }
                                    else  
                                    {
                                        <option value="1" selected>Active</option>
                                        <option value="0">InActive</option>
                                    }
                                     

                                </select>
                        </div>
                    </div>
                        </div>
                    </div>
                     
                    </div>  
                <div class="modal-footer">  
                    <a class="btn btn-small btn-danger" onclick="Dismis()">Close</a>
                    <a class="btn btn-small btn-success" onclick="Update()" id="Save">Save</a>
                    <a class="btn btn-small btn-warning" onclick="Update()" id="Update" style="display:none;">Update</a>

                </div>
            </form>

  </div>
</div>


<div class="card mb-3">
    <div class="card-header">
        <i class="fas fa-table"></i>
        Appointment List
    </div>
    <div class="card-body">

        <div class="table-responsive">
            <table class="table table-bordered" width="100%" cellspacing="0" id="tblVisitorInfo">
                <thead>
                    <tr>
                        <th>#SL</th>
                        <th>Doctor Name</th>
                        <th>Department</th> 
                        <th>Designation Name</th>
                         <th>Gender</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="dtVisitorInfo">
                </tbody>
            </table>
        </div>
    </div>
    <div class="card-footer small text-muted"></div>
</div>


 


@section Scripts{
    <script src="https://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
    <script src="https://www.jqueryscript.net/demo/Material-Time-Picker-Plugin-jQuery-MDTimePicker/mdtimepicker.js"></script>
    <script src="~/SweetAlert/sweetalert2.common.js"></script>
    <script src="~/SweetAlert/sweetalert2.js"></script>
    <script>
        $(document).ready(function () {
            var date = '@DateTime.Now.ToString("MM-dd-yyyy")';
             

            $('#frmDate').datepicker({ dateFormat: "dd-M-yy", showAnim: "scale", changeMonth: true, changeYear: true, yearRange: "1900:2100" });
            $('#frmTime').mdtimepicker({
                timeFormat: 'hh:mm:ss.000',
                format: 'hh:mm',
                pick12HourFormat: false,
                theme: 'dark',
                readOnly: true,
                hourPadding: true,
                clearBtn: false
            });

            //$('#departmentId').select2();
            //$('#doctorSpecializationId').select2();

            $('#dataTable').DataTable({

                "pageLength": 100
            });

            $(function () {
                $('[data-toggle="tooltip"]').tooltip()
            });
            var branchId = $('#branchId').val();
            Common.Ajax('GET', '/Appointment/GetAllDoctorData?branchId=' + branchId, [], 'json', ajaxDoctorData, false);



             
            //var interval = setInterval(function () {
            //    Common.Ajax('GET', '/Appointment/GetTodayAppointmentData?date=' + date, [], 'json', ajaxTodayAppointmentData, false);
            //}, 60000);
        });

        function ajaxDoctorData(res){
             console.log(res);
            var option = '';
             $('#tblVisitorInfo').dataTable().fnClearTable();
            $('#tblVisitorInfo').dataTable().fnDestroy();
            $.each(res, function (i, item) {
                var status = 'light';
                if (item.doctorstatus == "Active") {
                    status = 'success';
                }
                else if (item.doctorstatus == "InActive") {
                    status = 'warning';
                }

                else {

                }
                option += `<tr>
                                 <td>${i + 1}</td>
                                 <td>${item.name}</td>
                                 <td>${item.departmentName}</td>
                                 <td>${item.designationName}</td>
                                 <td>${item.gender}</td>
                                 @*<td>${item.status}</td>*@
                                 <td><span class="badge badge-${status}">${item.doctorstatus}</span></td>
                                 <td>
                                          <a class="btn btn-sm btn-success" href="#" onclick="Edit(${item.id},'${item.name}','${item.departmentId}','${item.designationName}','${item.doctorSpecializationId}','${item.gender}',${item.status})">Edit</a>
                                         <a class="btn btn-sm btn-danger" onclick="Delete(${item.id})">Delete</a>
                                  </td>
                                    
                                </tr>`
            })

            $('#dtVisitorInfo').empty();
            $('#dtVisitorInfo').append(option);
            $('#tblVisitorInfo').DataTable({
                "ordering": false,
                scrollX: true,
                scrollY: "490px",
                "scrollCollapse": true
            });
        } 


        function Delete(id) {
            swal({
                title: 'Are you sure?', text: 'Do you want to delete this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, delete it!'
            }).then(function () {
                $.ajax({
                    url: '/Appointment/DeleteDoctor?id=' + id,
                    method: 'GET',
                    success: function (data) {
                        location.reload();
                    },
                    error: function (error) {
                        console.error('Error:', error);
                    }
                });
            });
        }
        function Dismis() {
            $('#createDoctor').hide();
            $('#create').show();
           location.reload();
        }

        function Add() {
            $('#createDoctor').show();
            $('#create').hode();
        }

        function Edit(id, name, departmentId, designationName, doctorSpecializationId, gender, status) {
            $('#frmid').val(id); 
            $('#name').val(name);
            //$('#departmentName').val(departmentName);
            $('#departmentId').val(departmentId);
            $('#designationName').val(designationName);
            $('#doctorSpecializationId').val(doctorSpecializationId);
            $('#gender').val(gender);
            $('#status').val(status); 
            $('#createDoctor').show();
            $('#Update').show();
             $('#Save').hide();
        }


        function Update() {
            var data = $('#EditAppointmentForm').serialize();

            swal({
                title: 'Are you sure?', text: 'Do you want to Save this record!', type: 'warning', showCancelButton: true, confirmButtonColor: '#3085d6', cancelButtonColor: '#d33', confirmButtonText: 'Yes, update it!'
            }).then(function () {
                $.ajax({
                    url: '/Appointment/UpdateDoctor',
                    method: 'POST',
                    data: data,
                    success: function (data) {
                        location.reload();
                    },
                    error: function (error) {
                        console.error('Error:', error);
                    }
                });
            });
        }
    </script>
}
