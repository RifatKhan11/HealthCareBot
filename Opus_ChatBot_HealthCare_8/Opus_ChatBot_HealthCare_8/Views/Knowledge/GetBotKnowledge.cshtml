@model BotKnowledgeViewModel
@{
    ViewData["Title"] = "BotKnowledge";
}
<style>

</style>


<div class="card mb-3">
    <div class="card-header">
        <i class="fas fa-table"></i>
         BotKnowledge
    </div>



    <div class="card mb-3">
        <div class="card-body">
            <form id="CreateBotKnowledgeId" method="post" enctype="multipart/form-data">
                <input type="hidden" class="form-control" id="Id" name="Id" value="0">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="ParrentMenuName">Question</label>
                            <input type="text" class="form-control" id="QuestionId" value="" name="Questiontext" required>
                        </div>
                        <div class="form-group">
                            <label for="ParrentMenuName">Text Reply</label>
                            <input type="text" class="form-control" id="TextReplyId" value="" name="TextReply" required>
                        </div>
                        <div class="form-group">
                            <label for="ParrentMenuName">Key Word</label>
                            <select class="form-control" id="KeyWordQuesAnsId" name="KeyWordQuesAnsId" required>
                                <option value="">KeyWord List</option>
                                @foreach (var data in Model.KeyWordQuesAnsS)
                                {
                                    <option value="@data.Id">@data.question</option>
                                }
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ParrentMenuName">Status</label>
                            <select class="form-control" id="StatusId" name="Status" required>
                                <option value="1">Active</option>
                                <option value=" ">InActive</option>
                            </select>
                        </div>




                        <button type="button" class="btn btn-outline-primary" style="float:right" onclick="SaveKnowledge()" value="">Save</button>
                    </div>
                </div>

            </form>
        </div>
    </div>
    <div>
        <div class="card mb-3">
            <div class="card-header">
                <i class="fas fa-table"></i>
                BotKnowledge List
            </div>
            <div class="table-responsive">
                <table class="table table-striped table-bordered" id="BotKnowledgelIST" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th>#SL</th>
                            <th>Question</th>
                            <th>Text Reply</th>
                            <th>Key Word</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>

            </div>
        </div>
    </div>
</div>

@section Scripts{

    <script>

        $(document).ready(function () {

            GetAllBotKnowledge();

            $('#CreateBotKnowledge').DataTable({
                "columnDefs": [
                    { "width": "15%", "targets": 0 },
                    { "width": "25%", "targets": 1 },
                    { "width": "20%", "targets": 2 },
                    { "width": "25%", "targets": 3 },
                    { "width": "15%", "targets": 4 },
                    { "width": "15%", "targets": 5 }

                ],
                "pageLength": 100
            });


            $(function () {
                $('[data-toggle="tooltip"]').tooltip()
            });


        });

        
        function GetAllBotKnowledge() {
            Common.Ajax('GET', '/global/api/GetAllBotKnowledge', [], 'json', ajaxGetAllBotKnowledge, false);
        }

        function ajaxGetAllBotKnowledge(res) {
            console.log(res);
            var option = '';
            var sl = 1;
            var status = '';
            $.each(res, function (i, item) {
                if (item.status == 1) {
                    status = 'Active';
                }
                else {
                    status = 'InActive';
                }
                var keyWordQuesAnsId = item.keyWordQuesAnsId == null ? "" : item.keyWordQuesAnsId;
                option += `<tr>

                                                <td>${sl}</td >
                                                <td>${item.question}</td>
                                                <td>${item.textReply}</td>
                                                <td>${keyWordQuesAnsId}</td>
                                                <td>${status}</td>

                                                <td>
                                 <a href="#" onclick="EditKnowledge(${item.id},'${item.question}','${item.textReply}',${item.keyWordQuesAnsId},'${item.status} ')" class="btn btn-outline-warning btn-sm" data-toggle="tooltip" data-placement="bottom" title="Edit Question" "><i class="fas fa-edit"></i></a>
        <a href="#" onclick="RemoveKnowledge(${item.id})" class="btn btn-outline-danger btn-sm" data-toggle="confirmation-singleton" data-singleton="true" data-btn-ok-icon-class="material-icons" data-btn-ok-icon-content="check" data-btn-cancel-icon-class="material-icons" data-btn-cancel-icon-content="close" data-title="Agree to Delete it?"><i class="fas fa-trash"></i></a>

                                                </td>
                                            </tr>`
                sl = sl + 1;
            });

            $('#BotKnowledgelIST tbody').empty();
            $('#BotKnowledgelIST tbody').append(option);
            $('#BotKnowledgelIST').DataTable();
        }



        function SaveKnowledge() {
            var formData = $('#CreateBotKnowledgeId').serialize();
          

            $.ajax({
                type: 'POST',
                url: '/api/Knowledge/CreateBotKnowledge',
                //contentType: 'application/json',
                data: formData,
                async: false,
                success: function (response) {
                    if (parseInt(response) > 0) {
                        swal('Success', 'Saved Success', 'success').then(function () {
                            GetAllBotKnowledge();
                        });

                    }
                },
                error: function (error) {
                    swal('Warning', 'Saved Faild', 'warning');
                }
            });
        }
        function EditKnowledge(id, question, textReply, keyWordQuesAnsId, status) {
            $("#CreateBotKnowledgeId #Id").val(id);
            $("#CreateBotKnowledgeId #QuestionId").val(question);
            $("#CreateBotKnowledgeId #TextReplyId").val(textReply);
            $("#CreateBotKnowledgeId #KeyWordQuesAnsId").val(keyWordQuesAnsId);
            $("#CreateBotKnowledgeId #StatusId").val(status);


        }
        function RemoveKnowledge(id) {
            Common.Ajax('GET', '/global/api/DeleteBotKnowledge?bkId=' + id, [], 'json', ajaxRemoveKnowledge, false);
        }

        function ajaxRemoveKnowledge(res) {
            if (res == 1) {
                swal('Success', 'Delete Success', 'success').then(function () {
                    location.reload();
                });
            }
            else {
                swal('Warning', 'Delete Faild', 'warning');
            }
        }

    </script>
  }